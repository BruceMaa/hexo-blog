---
title: Linux记录之ssh
date: 2017-04-24
updated: 2017-04-25
category: 
- Technology
- Linux
tags:
- Linux
- ssh
---

## 名称

**ssh** — — OpenSSH SSH 客户端（远程登录程序）

## 概要

```
ssh [-1246AaCfGgKkMNnqsTtVvXxYy] [-b bind_address] [-c cipher_spec]
         [-D [bind_address:]port] [-E log_file] [-e escape_char]
         [-F configfile] [-I pkcs11] [-i identity_file]
         [-J [user@]host[:port]] [-L address] [-l login_name] [-m mac_spec]
         [-O ctl_cmd] [-o option] [-p port] [-Q query_option] [-R address]
         [-S ctl_path] [-W host:port] [-w local_tun[:remote_tun]]
         [user@]hostname [command]
```

<!-- more -->

## 描述

**ssh** (SSH客户端) 是一个登录到远程机器的程序，在远程机器上执行命令。它旨在通过不安全的网络在两个不受信任的主机之间提供安全的加密通信。X11连接，任意TCP端口和UNIX域套接字也可以通过安全通道转发。

**ssh**连接并登录到指定的**主机名**（具有可选的**用户名**）。用户必须使用以下几种方法之一向远程机器证明他/她的身份（见下文）。

如果指定了命令，它将在远程机器执行。

选项如下：

#####  -1    

> 强制**ssh**只尝试协议版本1.

##### -2

> 强制**ssh**只尝试协议版本2.

##### -4

> 强制**ssh**只使用IPv4.

##### -6

> 强制**ssh**只使用IPv6.

##### -A

> 启用认证代理连接的转发。这也可以在配置文件中的每个主机的基础上进行指定。

> 应该小心启用代理转发。能够绕过远程主机的文件权限的用户（对于代理的UNIX域套接字）可以通过转发的连接访问本地代理。 攻击者无法从代理获取密钥资料，但是他们可以对密钥执行操作，使其能够使用加载到代理中的身份进行身份验证。

##### -a

> 禁用认证代理连接的转发。

##### -b  bind_address

> 在本地机器上使用**bind_address**作为连接的源地址。 仅对具有多个地址的系统有用。

##### -C

> 请求压缩所有数据（包括stdin，stdout，stderr和转发的X11，TCP和UNIX域连接的数据）。 压缩算法与gzip使用的压缩算法相同，`level`可以由协议版本1的**CompressionLevel**选项控制。调制解调器线路和其他慢速连接需要压缩，但在快速网络上只会减慢。 默认值可以在配置文件中逐个主机设置; 请参阅**压缩**选项。

##### -c  cipher_spec

> 选择加密会话的密码规范。 协议版本1允许指定单个密码。 支持的值为`3des`，`blowfish`和`des`。 对于协议版本2，**cipher_spec**是以优先级顺序列出的以逗号分隔的密码列表。 有关详细信息，请参阅ssh_config中的**Ciphers**关键字。

##### -D  [bind_address:]port

> 指定本地`dynamic`应用级端口转发。 这可以通过分配一个套接字来侦听本地**端口**，可选地绑定到指定的**bind_address**。 无论何时连接到该端口，连接将通过安全通道转发，然后应用程序协议用于确定从远程机器连接到何处。 目前支持SOCKS4和SOCKS5协议，**ssh**将作为SOCKS服务器。 只有root可以转发特权端口。 动态端口转发也可以在配置文件中指定。

> 可以通过将地址括在方括号中来指定IPv6地址。 只有超级用户可以转发特权端口。 默认情况下，根据**GatewayPorts**设置绑定本地端口。 但是，可以使用显式的**bind_address**将连接绑定到特定的地址。 `localhost`的**bind_address**表示侦听端口仅限于本地使用，而空的地址或`*`表示端口应该从所有接口可用。

##### -E  log_file

> 将调试日志追加到**log_file**而不是标准错误。

##### -e  escape_char

> 使用pty（默认值：’〜’）设置会话的转义字符。转义字符只能在行的开始处被识别。 转义字符后跟一个点（’.’）关闭连接; 其次是control-Z挂起连接; 然后自己发送一次转义字符。 将字符设置为`none`可禁用任何转义，并使会话完全透明。

##### -F  configfile

> 指定一个替代每个用户的配置文件。 如果在命令行中给出了一个配置文件，系统范围的配置文件（**/etc/ssh/ssh_config**）将被忽略。 每个用户配置文件的默认值为**〜/.ssh/config**。

##### -f

> 请求**ssh**在命令执行之前转到后台。 如果**ssh**要求密码或密码短语，但用户在后台需要它时，这很有用。 这与 **-n** 参数相同。 在远程站点启动X11程序的推荐方法是像**ssh -f host xterm**。

> 如果**ExitOnForwardFailure**配置选项设置为`yes`，则以-f开头的客户端将在将其自身置于后台之前等待所有远程端口的转发成功建立。

##### -G

> 导致**ssh**在评估**主机**和**匹配**块并退出后打印其配置。

##### -g

> 允许远程主机连接到本地转发的端口。 如果在多路复用连接上使用，则必须在主进程上指定此选项。

##### -I  pkcs11

> 指定PKCS＃11共享库**ssh**应该用于与提供用户私有RSA密钥的PKCS＃11令牌进行通信。

##### -i  identity_file

> 选择一个读取用于公钥认证的身份（私钥）的文件。协议版本1的默认路径为**〜/.ssh/identity**，协议版本号为**〜/.ssh/id_dsa**，**〜/.ssh/id_ecdsa**，**〜/.ssh/id_ed25519**和**〜/.ssh/id_rsa**。身份文件也可以在每个主机的基础上在配置文件中指定。可以有多个**-i**选项（在配置文件中指定多个标识）。如果**CertificateFile**指令没有明确指定任何证书，**ssh**还将尝试从通过将**-cert.pub**追加到身份文件名获取的文件名加载证书信息。

##### -J  [user@]host[:port]

> 首先通过与跳转**主机**建立**ssh**连接，然后从那里建立TCP转发到最终目的地，连接到目标主机。可以用逗号分隔指定多级跳跃。 这是指定**ProxyJump**配置指令的快捷方式。

##### -K

> 启用GSSAPI认证和转发（委派）GSSAPI凭据给服务器。

##### -k

> 禁止向服务器转发（委派）GSSAPI凭据。

##### -L  [bind_address:]port:host:hostport
##### -L  [bind_address:]port:remote_socket
##### -L  local_socket:host:hostport
##### -L  local_socket:remote_socket

> 指定与本地（客户端）主机上的给定TCP端口或Unix套接字的连接将转发到远程端的给定主机和端口或Unix套接字。这可以通过分配套接字来侦听本地的TCP**端口**，可选地绑定到指定的**bind_address**或Unix套接字。无论何时连接到本地端口或套接字，连接将通过安全通道转发，并从远程机器连接到**主机**端口**主机端口**或Unix套接字**remote_socket**。

> 端口转发也可以在配置文件中指定。 只有超级用户可以转发特权端口。 可以通过将地址括在方括号中来指定IPv6地址。

> 默认情况下，根据**GatewayPorts**设置绑定本地端口。 但是，可以使用显式的**bind_address**将连接绑定到特定的地址。`localhost`的**bind_address**表示侦听端口仅限于本地使用，而空的地址或`*`表示端口应该从所有接口可用。

##### -l  login_name

> 指定用户在远程机器上登录。 这也可以在每个主机的基础上在配置文件中指定。

##### -M

> 将**ssh**客户端置于`master`模式下进行连接共享。 多个**-M**选项将**ssh**置于`master`模式，在接受从属连接之前需要确认。 有关详细信息，请参阅ssh_config中的**ControlMaster**的说明。

##### -m  mac_spec

> 以逗号分隔的MAC（消息认证码）算法列表，以优先级顺序指定。 有关更多信息，请参阅**MACs**关键字。

##### -N

> 不要执行远程命令。 这对于转发端口是有用的。

##### -n

> 从**/dev/null**重定向stdin（实际上，阻止从stdin读取）。当ssh在后台运行时，必须使用它。 一个常见的技巧是使用它来在远程机器上运行X11程序。例如，**ssh -n shadows.cs.hut.fi emacs＆**将在shadows.cs.hut.fi上启动一个emacs，X11连接将通过加密通道自动转发。ssh程序将放在后台。 （如果ssh需要输入密码或口令，则此操作不起作用;另请参阅**-f**选项。）

##### -O  ctl_cmd

> 控制主动连接复用主控制程序。 当指定**-O**选项时，**ctl_cmd**参数被解释并传递给主进程。有效的命令是：`check`（检查主进程是否正在运行），`forward`（请求转发而不执行命令），`cancel`（取消转发），`exit` （主机退出）和`stop`（请求主机停止接受进一步的复用请求）。

##### -o  option

> 可用于以配置文件中使用的格式提供选项。 这对于指定没有单独的命令行标志的选项很有用。 有关下列选项的完整详细信息及其可能的值，请参阅ssh_config。
> 
* AddKeysToAgent
* AddressFamily
* BatchMode
* BindAddress
* CanonicalDomains
* CanonicalizeFallbackLocal
* CanonicalizeHostname
* CanonicalizeMaxDots
* CanonicalizePermittedCNAMEs
* CertificateFile
* ChallengeResponseAuthentication
* CheckHostIP
* Cipher
* Ciphers
* ClearAllForwardings
* Compression
* CompressionLevel
* ConnectionAttempts
* ConnectTimeout
* ControlMaster
* ControlPath
* ControlPersist
* DynamicForward
* EscapeChar
* ExitOnForwardFailure
* FingerprintHash
* ForwardAgent
* ForwardX11
* ForwardX11Timeout
* ForwardX11Trusted
* GatewayPorts
* GlobalKnownHostsFile
* GSSAPIAuthentication
* GSSAPIDelegateCredentials
* HashKnownHosts
* Host
* HostbasedAuthentication
* HostbasedKeyTypes
* HostKeyAlgorithms
* HostKeyAlias
* HostName
* IdentitiesOnly
* IdentityAgent
* IdentityFile
* Include
* IPQoS
* KbdInteractiveAuthentication
* KbdInteractiveDevices
* KexAlgorithms
* LocalCommand
* LocalForward
* LogLevel
* MACs
* Match
* NoHostAuthenticationForLocalhost
* NumberOfPasswordPrompts
* PasswordAuthentication
* PermitLocalCommand
* PKCS11Provider
* Port
* PreferredAuthentications
* Protocol
* ProxyCommand
* ProxyJump
* ProxyUseFdpass
* PubkeyAcceptedKeyTypes
* PubkeyAuthentication
* RekeyLimit
* RemoteForward
* RequestTTY
* RhostsRSAAuthentication
* RSAAuthentication
* SendEnv
* ServerAliveInterval
* ServerAliveCountMax
* StreamLocalBindMask
* StreamLocalBindUnlink
* StrictHostKeyChecking
* TCPKeepAlive
* Tunnel
* TunnelDevice
* UpdateHostKeys
* UsePrivilegedPort
* User
* UserKnownHostsFile
* VerifyHostKeyDNS
* VisualHostKey
* XAuthLocation

##### -p  port

> 要连接到远程主机的端口。 这可以在配置文件中的每个主机的基础上进行指定。

##### -Q  query_option

> 用于指定版本2支持的算法的查询**ssh**。可用的功能包括：**cipher**（支持的对称密码），**cipher-auth**（支持认证加密的支持的对称密码），**mac**（支持的消息完整性代码），**kex**（密钥交换算法），**key**（密钥类型），**key-cert** （证书密钥类型），**key-plain**（非证书密钥类型）和**protocol-version**（支持的SSH协议版本）。

##### -q

> 静音模式。 大多数警告和诊断消息被抑制。